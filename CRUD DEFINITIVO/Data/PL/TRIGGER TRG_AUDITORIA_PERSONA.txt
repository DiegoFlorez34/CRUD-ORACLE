CREATE OR REPLACE NONEDITIONABLE TRIGGER TRG_AUDITORIA_PERSONA
AFTER INSERT OR UPDATE OR DELETE ON PERSONA
FOR EACH ROW
DECLARE
    v_operacion VARCHAR2(20);
    v_persona_id NUMBER;
BEGIN
    -- Determinar tipo de operación
    IF INSERTING THEN
        v_operacion := 'INSERT';
        v_persona_id := :NEW.PERSONAID;
    ELSIF UPDATING THEN
        v_operacion := 'UPDATE';
        v_persona_id := :OLD.PERSONAID;
    ELSIF DELETING THEN
        v_operacion := 'DELETE';
        v_persona_id := :OLD.PERSONAID;
    END IF;

    -- Insertar registro en la tabla de auditoría
    INSERT INTO AUDITORIA_PERSONA (
        OPERACION,
        PERSONA_ID,
        NOMBRE_ANTERIOR, NOMBRE_NUEVO,
        FECHA_NACIMIENTO_ANTERIOR, FECHA_NACIMIENTO_NUEVA,
        CORREO_ANTERIOR, CORREO_NUEVO,
        TIPO_DOCUMENTO_ANTERIOR, TIPO_DOCUMENTO_NUEVO,
        TIPO_PERSONA_ANTERIOR, TIPO_PERSONA_NUEVO,
        NUMERO_DOCUMENTO_ANTERIOR, NUMERO_DOCUMENTO_NUEVO,
        FECHA_OPERACION
    )
    VALUES (
        v_operacion,
        v_persona_id,
        :OLD.NOMBRE, :NEW.NOMBRE,
        :OLD.FECHA_NACIMIENTO, :NEW.FECHA_NACIMIENTO,
        :OLD.CORREO, :NEW.CORREO,
        :OLD.TIPODOCUMENTOID, :NEW.TIPODOCUMENTOID,
        :OLD.TIPOPERSONAID, :NEW.TIPOPERSONAID,
        :OLD.NUMERODOCUMENTO, :NEW.NUMERODOCUMENTO,
        SYSDATE
    );
END;



 CREATE TABLE AUDITORIA_PERSONA (  
    AUDITORIA_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    OPERACION varchar2(20),
    PERSONA_ID NUMBER,
    NOMBRE_ANTERIOR varchar2(100),
    NOMBRE_NUEVO varchar2(100),
    FECHA_NACIMIENTO_ANTERIOR DATE, 
    FECHA_NACIMIENTO_NUEVA DATE,
    CORREO_ANTERIOR varchar2(100),
    CORREO_NUEVO varchar2(100),
    TIPO_DOCUMENTO_ANTERIOR Number(3), 
    TIPO_DOCUMENTO_NUEVO Number(3), 
    TIPO_PERSONA_ANTERIOR Number(3), 
    TIPO_PERSONA_NUEVO Number(3), 
    NUMERO_DOCUMENTO_ANTERIOR varchar2(100),
    NUMERO_DOCUMENTO_NUEVO varchar2(100),
    FECHA_OPERACION DATE DEFAULT SYSDATE
 )