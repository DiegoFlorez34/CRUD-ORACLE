create or replace NONEDITIONABLE TRIGGER TRG_AUDITORIA_TIPOPERSONA
AFTER INSERT OR UPDATE OR DELETE ON TIPOPERSONA
FOR EACH ROW
DECLARE
    v_operacion VARCHAR2(20);
    v_TIPOPERSONA_id NUMBER;
BEGIN
    -- Determinar tipo de operación
    IF INSERTING THEN
        v_operacion := 'INSERT';
        v_TIPOPERSONA_id := :NEW.TIPOPERSONAID;
    ELSIF UPDATING THEN
        v_operacion := 'UPDATE';
        v_TIPOPERSONA_id := :OLD.TIPOPERSONAID;
    ELSIF DELETING THEN
        v_operacion := 'DELETE';
        v_TIPOPERSONA_id := :OLD.TIPOPERSONAID;
    END IF;

    -- Insertar registro en la tabla de auditoría
    INSERT INTO AUDITORIA_TIPOPERSONA (
        OPERACION,
        TIPOPERSONA_ID,
        DESCRIPCION_ANTERIOR,
        DESCRIPCION_NUEVO,
        FECHA_OPERACION
    )
    VALUES (
        v_operacion,
        v_TIPOPERSONA_id,
        :OLD.DESCRIPCION, :NEW.DESCRIPCION,
        SYSDATE
    );
END;


CREATE TABLE AUDITORIA_TIPOPERSONA (  
    AUDITORIA_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    OPERACION varchar2(20),
    TIPOPERSONA_ID NUMBER,
    DESCRIPCION_ANTERIOR varchar2(100),
    DESCRIPCION_NUEVO varchar2(100),
    FECHA_OPERACION DATE DEFAULT SYSDATE
 )
